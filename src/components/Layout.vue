<template>
    <div class="layout-container">
        <el-container>
            <!-- 顶部导航栏 -->
            <el-header class="header">
                <div class="header-left">
                    <div class="logo">
                        <!-- <img :src="logo" alt="logo" /> -->
                        <svg t="1753178705522" class="icon" viewBox="0 0 1365 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="5714" width="30" height="30">
                            <path
                                d="M1182.66855013 996.7404278c-89.55622287-1013.47629145-160.10976336-1042.9060845-160.10976489-1042.90608291-66.3632078 16.17664022-138.47594357 190.70895169-138.4759436 190.70895168-51.8432097-24.45986035-145.1025184-19.10013079-145.10251841-19.1001308s-93.2593087-5.35973113-145.10251997 19.1001308c0 0-72.11273579-174.53231146-138.47594201-190.70895168 0 0-68.0198515 28.45529619-155.33473223 989.79602792l-15.10469495-0.29234999h-29.33234306c-2.43624057-0.09744999-7.01637483-0.58469841-10.71946069-1.26684527-3.89798586-0.77959684-7.89342169-1.46174528-11.69395594-2.63114057-31.57368518-8.08832012-57.20294082-28.65019463-69.38414678-58.37233611-2.04644213-3.4107374-2.82603899-7.60107168-4.28778428-11.40160752-1.36429529-3.89798586-3.020939-7.60107168-3.70308586-11.59650755l-3.02093898-11.79140753c-0.58469841-3.89798586-0.77959684-7.7959717-1.26684529-11.69395753-1.26684528-15.68939181 0.19490001-31.76858362 5.94442799-45.80133173 5.65207956-14.0327481 15.00724496-26.99355091 27.96804778-37.61556159 6.43167642-5.26228114 13.35060124-10.32966225 20.85422292-14.61744653 3.80053586-2.04644213 7.60107168-4.19033428 11.59650754-5.94442956 3.80053586-1.8515437 8.38067011-3.60563743 11.2067091-4.67758269l2.63114058-1.07194529c9.16026695-3.60563743 14.81234653-13.35060124 12.86335281-23.38791506a20.77626387 20.77626387 0 0 0-24.45986036-16.37154025c-6.82147483 1.36429529-11.88885596 2.53369056-17.5409355 4.28778427-5.55462954 1.65664371-10.81691068 3.70308585-16.07919182 5.84697956-10.52456224 4.38523427-20.85422295 9.74496382-30.59918833 16.37154025-19.48992924 13.05825282-37.12831474 31.37878518-48.43247229 53.88965183-22.12106979 45.50898327-19.48992924 98.22923984 0.77959684 141.10708415 9.93986383 21.92616978 25.82415563 42.00079586 44.72938647 57.78763766 18.90523081 15.98174181 41.22119901 26.99355091 64.31676563 33.3277789 5.74952956 1.75409372 11.69395754 2.82603899 17.63838396 3.89798584 6.23677641 0.97449686 12.66845439 2.92348898 20.17207766 3.41073742 9.93986383 0.68214686 39.46710531 3.89798586 39.46710531 3.89798585 18.80778082 1.26684528 35.76401947 5.35973113 54.18200182 7.01637483 55.54629711 7.89342169 167.12613819 15.00724496 390.28582194 13.93529812 481.88848694 2.33879214 443.59077691-33.1328789 443.59077689-33.13287892zM540.76774828 447.70913777c-27.48079935 0-49.79676756-22.31596822-49.79676755-49.79676912s22.31596822-49.79676756 49.79676755-49.79676756c27.48079935 0 49.79676756 22.31596822 49.79676756 49.79676756S568.24854761 447.70913777 540.76774828 447.70913777z m267.30437174 116.64722223h-48.33502228a4.5801327 4.5801327 0 0 1-3.41073741-1.46174373l-17.3460371-17.34603708-17.34603708 17.34603708a4.96993113 4.96993113 0 0 1-3.41073744 1.46174373h-48.33502227v-9.74496384h46.28858015l18.41798238-18.41798237c0.87704685-1.65664371 2.63114055-2.33879214 4.48268427-2.33879213 1.55919372 0 3.11838898 0.58469841 4.09288428 1.94899373l18.8077808 18.80778077h46.2885817v9.74496384zM937.19289821 447.70913777c-27.48079935 0-49.79676756-22.31596822-49.79676757-49.79676912s22.31596822-49.79676756 49.79676757-49.79676756c27.48079935 0 49.79676756 22.31596822 49.79676754 49.79676756S964.67369754 447.70913777 937.19289821 447.70913777z"
                                fill="#1296db" p-id="5715"></path>
                            <path
                                d="M540.76774828 397.91236865m-49.79676755 0a49.79676756 49.79676756 0 1 0 99.59353511 0 49.79676756 49.79676756 0 1 0-99.59353511 0Z"
                                fill="#FFFFFF" p-id="5716"></path>
                            <path
                                d="M937.19289821 397.91236865m-49.79676757 0a49.79676756 49.79676756 0 1 0 99.59353511 0 49.79676756 49.79676756 0 1 0-99.59353511 0Z"
                                fill="#FFFFFF" p-id="5717"></path>
                            <path
                                d="M734.49763897 536.29086223l-18.41798238 18.41798391h-46.28858014v9.74496385h48.33502228c1.26684528 0 2.53369056-0.48724843 3.41073743-1.46174528l17.34603707-17.34603551v-11.69395753c-1.75409372-0.09744999-3.60563743 0.68214686-4.38523426 2.33879056z"
                                fill="#FFFFFF" p-id="5718"></path>
                            <path
                                d="M756.32636033 562.99206471c0.87704685 0.87704685 2.14389213 1.46174528 3.41073741 1.46174528h48.33502228v-9.74496385h-46.28858015l-18.80778078-18.80778233c-0.87704685-1.36429529-2.53369056-1.94899214-4.09288586-1.94899214v11.69395753l17.4434871 17.34603551z"
                                fill="#FFFFFF" p-id="5719"></path>
                        </svg>
                        <span>Clash 管理面板</span>
                    </div>
                    <el-breadcrumb separator="/" class="breadcrumb">
                        <el-breadcrumb-item v-for="item in currentMenu" :key="item">{{ item }}</el-breadcrumb-item>
                    </el-breadcrumb>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <el-avatar :size="32" :src="userInfo.avatar">
                            <el-icon>
                                <User />
                            </el-icon>
                        </el-avatar>
                        <span>{{ userInfo.username }}</span>
                    </div>
                </div>
            </el-header>

            <el-container>
                <!-- 侧边菜单 -->
                <el-aside class="sidebar" width="240px">
                    <el-menu :default-active="activeMenu" class="el-menu-vertical" unique-opened router>
                        <template v-for="menu in menuList" :key="menu.name">
                            <el-sub-menu v-if="menu.children && menu.children.length > 1" :index="menu.name">
                                <template #title>
                                    <el-icon>
                                        <component :is="menu.icon" />
                                    </el-icon>
                                    <span>{{ menu.title }}</span>
                                </template>
                                <el-menu-item v-for="child in menu.children" :key="child.name" :index="child.name"
                                    :route="child.path">
                                    {{ child.title }}
                                </el-menu-item>
                            </el-sub-menu>
                            <el-menu-item v-else :index="menu.name" :route="menu.path">
                                <el-icon>
                                    <component :is="menu.icon" />
                                </el-icon>
                                {{ menu.title }}
                            </el-menu-item>
                        </template>
                    </el-menu>
                </el-aside>

                <el-container>
                    <!-- 主内容区域 -->
                    <el-main class="main-content">
                        <router-view></router-view>
                    </el-main>

                    <!-- 底部信息栏 -->
                    <el-footer class="footer" height="60px">
                        <span>© 2025 Clash 管理面板. All Rights Reserved. | Version 1.0.0</span>
                    </el-footer>
                </el-container>
            </el-container>
        </el-container>
    </div>
</template>

<script lang="ts" setup>
import { ref, reactive, onMounted, computed } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { useStore } from '@/stores/auth'
import { useRoute, useRouter } from 'vue-router'
import logo from '@/assets/logo.png'

const store = useStore()
const userInfo = ref(store.userInfo)
const route = useRoute()
const router = useRouter()

const menuList = ref([])

// 菜单面包屑
const currentMenu = computed(() => {
    return route.matched.map(item => item.meta.title).filter(item => item)
})
const activeMenu = computed(() => {
    return route.name
})

const getMenuFromRoutes = () => {
    // 获取 home 路由
    const homeRoute = router.options.routes.find(r => r.name === 'home')
    if (!homeRoute || !homeRoute.children) return []

    // 递归生成菜单
    function mapRoutesToMenu(routes) {
        return routes.map(route => {
            const menu: any = {
                title: route.meta?.title || route.name,
                path: route.path,
                name: route.name,
                hidden: route.meta.hidden,
                icon: route.meta.icon,
            }
            if (route.children && route.children.length > 0) {
                menu.children = mapRoutesToMenu(route.children).filter(item => !item.hidden)
            }
            return menu
        })
    }

    return mapRoutesToMenu(homeRoute.children).filter(item => !item.hidden)
}

onMounted(() => {
    menuList.value = getMenuFromRoutes()
})

</script>

<style lang="scss" scoped>
.layout-container {
    height: 100vh;

    .header {
        background: #304156;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);

        .header-left {
            display: flex;
            align-items: center;

            .logo {
                display: flex;
                align-items: center;
                gap: 10px;

                span {
                    font-size: 24px;
                    font-weight: bold;
                    margin-right: 20px;
                    color: #fff;
                }
            }

            .breadcrumb {
                margin-left: 20px;
                color: #fff;
                display: flex;
                justify-content: center;
                align-items: center;

                :deep(.el-breadcrumb__inner) {
                    font-size: 14px;
                    color: #fff;
                }

                :deep(.el-breadcrumb__separator) {
                    color: #fff;
                }
            }
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;

            .user-info {
                display: flex;
                align-items: center;
                gap: 8px;

                &:hover {
                    cursor: pointer;
                }
            }
        }
    }

    .sidebar {
        background: #304156;
        overflow-x: hidden;

        :deep(.el-menu) {
            border-right: none;
        }

        :deep(.el-menu--vertical) {
            background-color: #304156;
        }

        :deep(.el-menu-item) {
            color: #bfcbd9;

            &.is-active {
                background-color: #409EFF !important;
                color: #ffffff !important;
            }

            &:hover {
                background-color: #409EFF;
                color: #ffffff;
            }
        }

        :deep(.el-sub-menu__title) {
            color: #bfcbd9;

            &:hover {
                background-color: #409EFF;
                color: #ffffff;
            }
        }

        :deep(.el-menu--inline) {
            background-color: #263445;
        }
    }

    .main-content {
        background: #f0f2f5;
        padding: 20px;
        min-height: calc(100vh - 121px);
        height: calc(100vh - 121px);
        overflow: auto;
    }

    .footer {
        background: #fff;
        color: #666;
        text-align: center;
        line-height: 60px;
        border-top: 1px solid #e8e8e8;
        font-size: 14px;
    }

}
</style>